!function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}function a(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+s).toString(36))}function o(t){return"object"==typeof t?null!==t:"function"==typeof t}function i(t){if(!o(t))throw TypeError(t+" is not an object!");return t}function n(t){try{return!!t()}catch(t){return!0}}function r(t){return f?d.createElement(t):{}}function m(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}var h=t(function(t){var e=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=e)}),y=(h.version,t(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),c=t(function(t){var e="__core-js_shared__",n=y[e]||(y[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:h.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),e=0,s=Math.random(),l=t(function(t){var e=c("wks"),n=y.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:a)("Symbol."+t))}).store=e}),u=!n(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),d=y.document,f=o(d)&&o(d.createElement),p=!u&&!n(function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}),g=Object.defineProperty,x={f:u?Object.defineProperty:function(t,e,n){if(i(t),e=function(t,e){if(!o(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!o(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!o(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!o(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),i(n),p)try{return g(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},w=u?function(t,e,n){return x.f(t,e,m(1,n))}:function(t,e,n){return t[e]=n,t},v=l("unscopables"),b=Array.prototype;null==b[v]&&w(b,v,{});function A(t){b[v][t]=!0}function O(t,e){return{value:e,done:!!t}}function _(t){return M.call(t).slice(8,-1)}function C(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}function L(t){return j(C(t))}function T(t,e){return R.call(t,e)}function S(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}function k(r,a,t){if(S(r),void 0===a)return r;switch(t){case 1:return function(t){return r.call(a,t)};case 2:return function(t,e){return r.call(a,t,e)};case 3:return function(t,e,n){return r.call(a,t,e,n)}}return function(){return r.apply(a,arguments)}}var F={},M={}.toString,j=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==_(t)?t.split(""):Object(t)},R={}.hasOwnProperty,P=c("native-function-to-string",Function.toString),N=t(function(t){var o=a("src"),e="toString",i=(""+P).split(e);h.inspectSource=function(t){return P.call(t)},(t.exports=function(t,e,n,r){var a="function"==typeof n;a&&(T(n,"name")||w(n,"name",e)),t[e]!==n&&(a&&(T(n,o)||w(n,o,t[e]?""+t[e]:i.join(String(e)))),t===y?t[e]=n:r?t[e]?t[e]=n:w(t,e,n):(delete t[e],w(t,e,n)))})(Function.prototype,e,function(){return"function"==typeof this&&this[o]||P.call(this)})}),D="prototype",E=function(t,e,n){var r,a,o,i,c=t&E.F,s=t&E.G,l=t&E.S,u=t&E.P,d=t&E.B,f=s?y:l?y[e]||(y[e]={}):(y[e]||{})[D],p=s?h:h[e]||(h[e]={}),g=p[D]||(p[D]={});for(r in s&&(n=e),n)o=((a=!c&&f&&void 0!==f[r])?f:n)[r],i=d&&a?k(o,y):u&&"function"==typeof o?k(Function.call,o):o,f&&N(f,r,o,t&E.U),p[r]!=o&&w(p,r,i),u&&g[r]!=o&&(g[r]=o)};y.core=h,E.F=1,E.G=2,E.S=4,E.P=8,E.B=16,E.W=32,E.U=64,E.R=128;function B(t){return isNaN(t=+t)?0:(0<t?q:W)(t)}function I(t){return 0<t?K(B(t),9007199254740991):0}function z(c){return function(t,e,n){var r,a=L(t),o=I(a.length),i=function(t,e){return(t=B(t))<0?Y(t+e,0):X(t,e)}(n,o);if(c&&e!=e){for(;i<o;)if((r=a[i++])!=r)return!0}else for(;i<o;i++)if((c||i in a)&&a[i]===e)return c||i||0;return!c&&-1}}function H(t){return Q[t]||(Q[t]=a(t))}function V(){}function U(t,e,n){t&&!T(t=n?t:t.prototype,ut)&&lt(t,ut,{configurable:!0,value:e})}var G=E,W=Math.ceil,q=Math.floor,K=Math.min,Y=Math.max,X=Math.min,Q=c("keys"),J=z(!1),Z=H("IE_PROTO"),tt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),et=Object.keys||function(t){return function(t,e){var n,r=L(t),a=0,o=[];for(n in r)n!=Z&&T(r,n)&&o.push(n);for(;e.length>a;)T(r,n=e[a++])&&(~J(o,n)||o.push(n));return o}(t,tt)},nt=u?Object.defineProperties:function(t,e){i(t);for(var n,r=et(e),a=r.length,o=0;o<a;)x.f(t,n=r[o++],e[n]);return t},rt=y.document,at=rt&&rt.documentElement,ot=H("IE_PROTO"),it="prototype",ct=function(){var t,e=r("iframe"),n=tt.length;for(e.style.display="none",at.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ct=t.F;n--;)delete ct[it][tt[n]];return ct()},st=Object.create||function(t,e){var n;return null!==t?(V[it]=i(t),n=new V,V[it]=null,n[ot]=t):n=ct(),void 0===e?n:nt(n,e)},lt=x.f,ut=l("toStringTag"),dt={};w(dt,l("iterator"),function(){return this});function ft(t){return Object(C(t))}function pt(){return this}var gt=H("IE_PROTO"),ht=Object.prototype,yt=Object.getPrototypeOf||function(t){return t=ft(t),T(t,gt)?t[gt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ht:null},xt=l("iterator"),vt=!([].keys&&"next"in[].keys()),mt="values",wt=function(t,e,n,r,a,o,i){!function(t,e,n){t.prototype=st(dt,{next:m(1,n)}),U(t,e+" Iterator")}(n,e,r);function c(t){if(!vt&&t in g)return g[t];switch(t){case"keys":case mt:return function(){return new n(this,t)}}return function(){return new n(this,t)}}var s,l,u,d=e+" Iterator",f=a==mt,p=!1,g=t.prototype,h=g[xt]||g["@@iterator"]||a&&g[a],y=h||c(a),x=a?f?c("entries"):y:void 0,v="Array"==e&&g.entries||h;if(v&&(u=yt(v.call(new t)))!==Object.prototype&&u.next&&(U(u,d,!0),"function"!=typeof u[xt]&&w(u,xt,pt)),f&&h&&h.name!==mt&&(p=!0,y=function(){return h.call(this)}),!vt&&!p&&g[xt]||w(g,xt,y),F[e]=y,F[d]=pt,a)if(s={values:f?y:c(mt),keys:o?y:c("keys"),entries:x},i)for(l in s)l in g||N(g,l,s[l]);else G(G.P+G.F*(vt||p),e,s);return s}(Array,"Array",function(t,e){this._t=L(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,O(1)):O(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");F.Arguments=F.Array,A("keys"),A("values"),A("entries");for(var bt=l("iterator"),At=l("toStringTag"),Ot=F.Array,_t={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ct=et(_t),Lt=0;Lt<Ct.length;Lt++){var Tt,St=Ct[Lt],kt=_t[St],Ft=y[St],Mt=Ft&&Ft.prototype;if(Mt&&(Mt[bt]||w(Mt,bt,Ot),Mt[At]||w(Mt,At,St),F[St]=Ot,kt))for(Tt in wt)Mt[Tt]||N(Mt,Tt,wt[Tt],!0)}var jt=l("toStringTag"),Rt="Arguments"==_(function(){return arguments}()),Pt={};Pt[l("toStringTag")]="z",Pt+""!="[object z]"&&N(Object.prototype,"toString",function(){return"[object "+function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),jt))?n:Rt?_(e):"Object"==(r=_(e))&&"function"==typeof e.callee?"Arguments":r}(this)+"]"},!0);var Nt,Dt,Et,Bt;Nt="keys",Dt=function(){return function(t){return et(ft(t))}},Et=(h.Object||{})[Nt]||Object[Nt],(Bt={})[Nt]=Dt(Et),G(G.S+G.F*n(function(){Et(1)}),"Object",Bt);function It(t,e){return new(function(t){var e;return Ht(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!Ht(e.prototype)||(e=void 0),o(e)&&null===(e=e[Vt])&&(e=void 0)),void 0===e?Array:e}(t))(e)}function zt(d,t){var f=1==d,p=2==d,g=3==d,h=4==d,y=6==d,x=5==d||y,v=t||It;return function(t,e,n){for(var r,a,o=ft(t),i=j(o),c=k(e,n,3),s=I(i.length),l=0,u=f?v(t,s):p?v(t,0):void 0;l<s;l++)if((x||l in i)&&(a=c(r=i[l],l,o),d))if(f)u[l]=a;else if(a)switch(d){case 3:return!0;case 5:return r;case 6:return l;case 2:u.push(r)}else if(h)return!1;return y?-1:g||h?h:u}}var Ht=Array.isArray||function(t){return"Array"==_(t)},Vt=l("species"),Ut=zt(5),Gt="find",Wt=!0;Gt in[]&&Array(1)[Gt](function(){Wt=!1}),G(G.P+G.F*Wt,"Array",{find:function(t){return Ut(this,t,1<arguments.length?arguments[1]:void 0)}}),A(Gt);function qt(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}var Kt=zt(1);G(G.P+G.F*!qt([].map,!0),"Array",{map:function(t){return Kt(this,t,arguments[1])}});var Yt=[].sort,Xt=[1,2,3];G(G.P+G.F*(n(function(){Xt.sort(void 0)})||!n(function(){Xt.sort(null)})||!qt(Yt)),"Array",{sort:function(t){return void 0===t?Yt.call(ft(this)):Yt.call(ft(this),S(t))}});var Qt=x.f,$t=Function.prototype,Jt=/^\s*function ([^ (]*)/;"name"in $t||u&&Qt($t,"name",{configurable:!0,get:function(){try{return(""+this).match(Jt)[1]}catch(t){return""}}});var Zt=zt(0),te=qt([].forEach,!0);G(G.P+G.F*!te,"Array",{forEach:function(t){return Zt(this,t,arguments[1])}});var ee=zt(2);G(G.P+G.F*!qt([].filter,!0),"Array",{filter:function(t){return ee(this,t,arguments[1])}});var ne=z(!1),re=[].indexOf,ae=!!re&&1/[1].indexOf(1,-0)<0;G(G.P+G.F*(ae||!qt(re)),"Array",{indexOf:function(t){return ae?re.apply(this,arguments)||0:ne(this,t,arguments[1])}});function oe(){var v,s,c,l=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",u=[],d="init",t=520-0-5,e=35-7-0,n=d3.select(".data.EAdata").append("svg").attr("id","barChart_groupEastAsia"),r=d3.select(".data.NAdata").append("svg").attr("id","barChart_groupNAmer"),a=d3.select(".data.EUdata").append("svg").attr("id","barChart_groupRow3"),o=d3.select(".data.dataRow4").append("svg").attr("id","barChart_groupRow4"),f=d3.select("#barChartLegend").select("svg").attr("width",t).attr("height",e).attr("transform","translate(0,0)").style("vertical-align","middle");d3.select("#helpButton").on("click",function(){!function(){var t={parentContainerId:"#thisContainer"};t.helpArray=[{linkType:"dotOnly",divToHelpId:"helpTitleName",text:i18next.t("helpMapName",{ns:"helpOverlay"}),marginTop:150,marginLeft:-20,textLengthByLine:60,myTitle:i18next.t("helpTitle",{ns:"helpOverlay"}),myfooter:i18next.t("helpFooter",{ns:"helpOverlay"})},{linkType:"dotOnly",divToHelpId:"helpCardName",text:i18next.t("helpCardName",{ns:"helpOverlay"}),marginTop:100,marginLeft:-420,textLengthByLine:30},{linkType:"dotOnly",divToHelpId:"helpMenuName",text:i18next.t("helpMenuName",{ns:"helpOverlay"}),marginTop:375,marginLeft:-40,textLengthByLine:60},{linkType:"left",divToHelpId:"helpUnitsName",text:i18next.t("helpUnitsName",{ns:"helpOverlay"}),marginTop:400,marginLeft:515,textLengthByLine:35},{linkType:"dotOnly",divToHelpId:"helpBarsName",text:i18next.t("helpBarsName",{ns:"helpOverlay"}),marginTop:280,marginLeft:-410,textLengthByLine:30},{linkType:"left",divToHelpId:"helpBarHoverName",text:i18next.t("helpBarHover",{ns:"helpOverlay"}),marginTop:600,marginLeft:80,textLengthByLine:50}],new window.Help(t)}()});var i=d3.select("#cityCardDiv"),p=d3.select();function g(t){var e=t;p.remove();var n=i.selectAll(".cardrow",function(t){return t.id}).data(e);n.enter().append("div").attr("class",function(t,e){return 0===e?"cardrow titlerow row".concat(e):"cardrow subrow row".concat(e)}).html(function(t){return t.text}),n.attr("class",function(t,e){return 0===e?"cardrow titlerow row".concat(e):"cardrow updated row".concat(e)}).html(function(t){return t.text}),p=n.exit().attr("class","oldrow removed").text("")}function h(n){var r=[];return v.filter(function(t){if(t.region===n){var e={};e.region=t.region,e.city=t.city,e.s1PerCap=t.s1PerCap,e.storeOrig=t.storeOrig?t.storeOrig:null,r.push(e)}}),r.sort(function(t,e){return d3.descending(t.s1PerCap,e.s1PerCap)}),r}function y(t,e){t.sort(function(t,e){return d3.descending(t.s1PerCap,e.s1PerCap)});for(var n=0;n<e;n++){var r={};r.region=t[0].region,r.city="".concat(t[0].region,"_gap").concat(n),r.s1PerCap=null,r.storeOrig=null,t.push(r)}return t}function x(t,e,n){var r=[];if(r=h(n),"Europe"===n)r=y(r,3).concat(h("Southeast Asia"));else if("Latin America & Caribbean"===n){var a=y(r,1),o=y(h("South Asia"),1),i=y(h("Africa"),2),c=y(h("N Africa & W Asia"),1),s=h("Oceania");r=a.concat(o).concat(i).concat(c).concat(s)}else"North America"===n?r=y(r,1):"East Asia"===n&&(r=y(r,3));barChart(t,e,r),d3.select("#barChart_groupEastAsia").select(".margin-offset").attr("transform","translate(0, -70)"),d3.select("#barChart_groupNAmer").select(".margin-offset").attr("transform","translate(0, -115)"),d3.select("#barChart_groupRow3").select(".margin-offset").attr("transform","translate(0, -150)"),d3.select("#barChart_groupRow4").select(".margin-offset").attr("transform","translate(0, -190)");var l=d3.select("body").append("div").attr("class","tooltip-bar").style("opacity",0);d3.selectAll(".x.axis").selectAll("text").on("touchmove mousemove",function(t,e){if(-1===t.indexOf("gap")&&(d3.selectAll(".enlarged").classed("enlarged",!1),-1===d3.select(this).text().indexOf("_gap"))){var n=i18next.t(d3.select(this).text(),{ns:"cities"});d3.select(this).classed("enlarged",!0),d3.selectAll(".x.axis g :not(#text_".concat(n,")")).classed("fadeText",!0),b(d3.select(this).text())}}).on("mouseout",function(t){d3.selectAll(".x.axis g text").classed("fadeText",!1),O();var e=d3.select(".enlarged").text();d3.select(".bar-group.".concat(i18next.t(e,{ns:"cities"}))).select("rect").classed("active",!0),d3.select("#city".concat(i18next.t(e,{ns:"cities"}))).classed("cityactive",!0)}),d3.selectAll(".bar-group").on("touchmove mousemove",function(t,e){d3.selectAll(".enlarged").classed("enlarged",!1);var n=i18next.t(t.city,{ns:"cities"});d3.select("#text_".concat(n)).classed("enlarged",!0);var r=e+1;b(t.city);var a=i18next.t(t.city,{ns:"displayName"}),o=t.storeOrig?t.storeOrig:t.value;l.style("opacity",1),l.html("#".concat(r,". ").concat(a," <br>").concat(ge.formatNum(o)," ").concat(i18next.t("emissions per cap",{ns:"units"}))).style("left",d3.event.pageX+30+"px").style("top",d3.event.pageY+-20+"px")}).on("mouseout",function(t){l.style("opacity",0),O();var e=d3.select(".enlarged").text();d3.select(".bar-group.".concat(i18next.t(e,{ns:"cities"}))).select("rect").classed("active",!0),d3.select("#city".concat(i18next.t(e,{ns:"cities"}))).classed("cityactive",!0)})}function m(){function t(t,e){return de[d].colourRange[e]}function e(t,e){return"protocol"===d?i18next.t("".concat(d).concat(e+1),{ns:"legend"}):"region"===d?"":(n=0===e?u[d].lims[e]:u[d].levels[e-1],n=de[d].formatLevel?de[d].formatLevel(n):n,"".concat(n,"+"));var n}var n=de[d].xpos,r=d3.select("body").append("div").attr("class","tooltip-legend").style("opacity",0),a=f.attr("class","legendCB").selectAll(".legend").data(de[d].colourRange),o=a.enter().append("g").attr("class","legend").attr("id",function(t,e){return"cb".concat(e)});o.append("rect").attr("width",15).attr("height",15).attr("y",5).attr("x",function(t,e){return 51+85*e}).attr("fill",t),o.selectAll(".legend rect").on("touchmove mousemove",function(t,e){if("protocol"===d){var n=i18next.t("".concat(d).concat(e+1),{ns:"legend"});r.style("opacity",1),r.html("<b>".concat(n,"</b>: ").concat(i18next.t("".concat(n),{ns:"protocolFullName"}))).style("left",d3.event.pageX-100+"px").style("top",d3.event.pageY-70+"px")}}).on("mouseout",function(t){r.style("opacity",0)}),o.append("text").attr("class","legendText").text(e).attr("y",18).attr("x",function(t,e){return n[e]}),a.select("rect").attr("fill",t),a.select("text").text(e).attr("x",function(t,e){return n[e]}),a.exit().remove();var i=de[d].units,c=d3.select(".units");c.text(i),"HDD"===d||"CDD"===d||"low_bua_pc_2014"===d||"high_bua_pc_2014"===d?d3.select(".units").classed("unitsactive",!0):d3.select(".units").classed("unitsactive",!1);var s=d3.select("body").append("div").attr("class","tooltip-units").style("opacity",0);c.on("touchmove mousemove",function(){de[d].unitdef&&(s.style("opacity",1),s.html("<b>".concat(i18next.t(d,{ns:"attributes"}),"</b>: ").concat(de[d].unitdef)).style("left",d3.event.pageX-100+"px").style("top",d3.event.pageY-70+"px"))}).on("mouseout",function(t){s.style("opacity",0)})}function w(t){d3.select("#".concat(t)).text(i18next.t(t,{ns:"chartHeadings"}))}function b(e){var t=i18next.t(e,{ns:"cities"});O();var n=v.filter(function(t){return t.city===e})[0].country,r=v.filter(function(t){return t.city===e})[0].scope1,a=v.filter(function(t){return t.city===e})[0].year,o=v.filter(function(t){return t.city===e})[0].dataset,i=v.filter(function(t){return t.city===e})[0].protocol;r="Faro"===e||"Ajax"===e||"Band"===e||"Mont"===e?d3.format(".4f")(r):d3.format(".2f")(r);var c=i18next.t(e,{ns:"displayName"});s=[{id:1,text:"".concat(c,", ").concat(n)},{id:2,text:i18next.t("scope1Row",{ns:"cityCard"})},{id:3,text:"".concat(r," ").concat(i18next.t("scope1",{ns:"units"})," ").concat(i18next.t("defn",{ns:"units"}))},{id:4,text:i18next.t("yearRow",{ns:"cityCard"})},{id:5,text:a},{id:6,text:i18next.t("datasetRow",{ns:"cityCard"})},{id:7,text:i18next.t(o,{ns:"datasets"})},{id:8,text:i18next.t("protocolRow",{ns:"cityCard"})},{id:9,text:i18next.t(i,{ns:"protocol"})}],u[d]&&"protocol"!==d&"year"!==d&&A(d,e),g(s),d3.select(".bar-group.".concat(t)).select("rect").classed("active",!0),d3.selectAll(".bar-group:not(.".concat(t,")")).select("rect").classed("fade",!0),d3.selectAll("#city"+t).classed("cityactive",!0),d3.selectAll(".worldcity:not(#city"+t+")").classed("cityfade",!0),d3.selectAll(".worldcountry:not(#map".concat(i18next.t(n,{ns:"countries"}),")")).classed("countryfade",!0)}function A(t,e){var n,r=u[t].filter(function(t){return t.city===e})[0].value,a="N/A"===(n="string"==typeof r||r instanceof String?r:null===r?"N/A":d3.format(",")(r)?d3.format(",")(r):r)?"":i18next.t(t,{ns:"units"});s.push({id:10,text:i18next.t(t,{ns:"attributes"})},{id:11,text:"".concat(n," ").concat(a)})}function O(){d3.selectAll(".bar-group").selectAll("rect").classed("active",!1).classed("fade",!1),d3.selectAll(".cityactive").classed("cityactive",!1),d3.selectAll(".cityfade").classed("cityfade",!1),d3.selectAll(".countryfade").classed("countryfade",!1)}function _(e){var a,o=[],i=i18next.t(e,{ns:"barchartGroups"});a="Europe"===e?"".concat(i,"_").concat(e):"Southeast Asia"===e?"".concat(i,"_SEasia"):"Latin America & Caribbean"===e?"".concat(i,"_LA"):"South Asia"===e?"".concat(i,"_SA"):"N Africa & W Asia"===e?"".concat(i,"_NAWA"):i;var c=fe[a].xpos,s=fe[a].ypos,l=fe[a].arrowlength,u=fe[a].gid,d=0,f=0,p=0,g=0,h=200-g-f,y=200-d-p,x=[],n=0;v.filter(function(t){t.region===e&&t.storeOrig&&(x.push(t.storeOrig),o.push({id:n,name:"arrow"+n,path:"M 2,2 L2,11 L10,6 L2,2"}),n++)});for(var t=function(e){var t=d3.select("#barChart_".concat(i)).append("g").attr("class","barMarker").attr("id","g_".concat(u).concat(e)).attr("height",y+d+p).attr("transform","translate("+c[e]+","+s[e]+")").append("svg").attr("width",h+g+f),n=t.append("svg:defs"),r=t.append("svg:g").attr("id","markers".concat(e));n.selectAll("marker").data(o).enter().append("svg:marker").attr("id",function(t){return"marker_arrow".concat(e)}).attr("markerHeight",13).attr("markerWidth",13).attr("markerUnits","strokeWidth").attr("orient","auto").attr("refX",9.5).attr("refY",6).append("svg:path").attr("d",function(t){return t.path}),r.selectAll("path").data(o).enter().append("svg:path").attr("d",function(t,e){return"M 100, 0 V ".concat(l,", 0 ")}).attr("stroke-width",1.2).attr("marker-start",function(t){return"url(#marker_stub".concat(e,")")}).attr("marker-end",function(t){return"url(#marker_arrow".concat(e,")")}).attr("transform",function(t){return"scale(".concat(fe[a].arrowscale[0]," ").concat(fe[a].arrowscale[1],")")}).append("svg:path").attr("d",function(t){return t.path}),d3.select("#g_".concat(u).concat(e)).append("text").text(x[e]).attr("transform",function(){return"scale(".concat(fe[a].textscale[0]," ").concat(fe[a].textscale[1],")\n              translate(").concat(fe[a].textposx[e]," ").concat(fe[a].textposy[e],")")})},r=0;r<x.length;r++)t(r)}d3.select("#clearButton").on("click",function(){d3.selectAll(".enlarged").classed("enlarged",!1),d3.selectAll("rect.active").classed("active",!1),d3.selectAll(".cityactive").classed("cityactive",!1)}),i18n.load(["".concat(l,"/src/i18n")],function(){d3.queue().defer(d3.json,"".concat(l,"/data/cityApp_attributes_consolidated_fixedSet.json")).await(function(t,e){(v=e).map(function(e){e.scope1=d3.format(".3n")(e.scope1/1e6),Object.keys(pe).find(function(t){return t===e.city})&&(e.storeOrig=e.s1PerCap,e.s1PerCap=pe[e.city])}),d3.select("#clearButton").html(i18next.t("clearButton",{ns:"buttons"})),d3.select("#helpButton").html(i18next.t("helpButton",{ns:"buttons"})),d3.select("#download").html(i18next.t("downloadText",{ns:"pageText"})),d3.select("#titletag").html(i18next.t("titletag",{ns:"pageText"})),d3.select("#pageTitle").html(i18next.t("title",{ns:"pageText"})),d3.select("#chartHeading").html(i18next.t("yaxText",{ns:"chartHeadings"})),d3.select("label").html(i18next.t("label",{ns:"pageText"})),d3.select("#dropdownMenu").node()[0].text=i18next.t("val0",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[1].text=i18next.t("val1",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[2].text=i18next.t("val2",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[3].text=i18next.t("val3",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[4].text=i18next.t("val4",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[5].text=i18next.t("val5",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[6].text=i18next.t("val6",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[7].text=i18next.t("val7",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[8].text=i18next.t("val8",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[9].text=i18next.t("val9",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[10].text=i18next.t("val10",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[11].text=i18next.t("val11",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[12].text=i18next.t("val12",{ns:"dropdownMenu"}),d3.select("#dropdownMenu").node()[13].text=i18next.t("val13",{ns:"dropdownMenu"}),function(){var t=ue.width-ue.margin.left-ue.margin.right,e=ue.height-ue.margin.top-ue.margin.bottom,n=ue.projOptions.options,r=ue.projOptions.transScale;n.forEach(function(t){t.projection.rotate(ue.projOptions.rotateOrig).center(ue.projOptions.centreOrig)});var a=n[0].projection.scale(ue.scaleFactor).translate([t/r[0],e/r[1]]);c=d3.geoPath().projection(a).pointRadius([ue.defaultRadius]);var o=d3.geoGraticule(),i=d3.select("#map").append("svg").attr("width",t).attr("height",e).attr("transform","translate("+ue.delta[0]+","+ue.delta[1]+")").append("g");i.append("path").datum({type:"Sphere"}).attr("class","sphere").attr("d",c).attr("fill","#F4F7F7").attr("stroke","grey"),i.append("path").datum(o).attr("class","graticule").attr("d",c),d3.json("".concat(l,"/geojson/world_countries.json"),function(t,n){if(t)throw t;d3.json("".concat(l,"/geojson/our_cities.geojson"),function(t,e){if(t)throw t;i.attr("class","mapg").selectAll("path").data(n.features).enter().append("path").attr("d",c).attr("id",function(t){var e=i18next.t(t.properties.name,{ns:"countries"});return"map".concat(e)}).attr("class","worldcountry").style("stroke-width",1),e=i.selectAll("path").data(e.features).enter().append("path").attr("d",c).attr("id",function(t){var e=i18next.t(t.id,{ns:"reverse"});return"city"+i18next.t(e,{ns:"cities"})}).attr("class",function(t){var e=i18next.t(t.id,{ns:"reverse"}),n=v.filter(function(t){return t.city===e})[0];return n?"worldcity ".concat(i18next.t(n.region,{ns:"regions"})):"horsService"}).attr("r",10).on("mouseover",function(t){d3.selectAll(".enlarged").classed("enlarged",!1);var e=i18next.t(t.id,{ns:"reverse"});d3.select("#text_".concat(i18next.t(e,{ns:"cities"}))).classed("enlarged",!0),b(e)}).on("mouseout",function(t){O();var e=d3.select(".enlarged").text();d3.select(".bar-group.".concat(i18next.t(e,{ns:"cities"}))).select("rect").classed("active",!0),d3.select("#city".concat(i18next.t(e,{ns:"cities"}))).classed("cityactive",!0)})})})}(),g([{id:1,text:i18next.t("initTitle",{ns:"cityCard"})},{id:2,text:i18next.t("initRow1",{ns:"cityCard"})},{id:3,text:i18next.t("initRow2",{ns:"cityCard"})},{id:4,text:i18next.t("initRow3",{ns:"cityCard"})},{id:5,text:i18next.t("initRow4",{ns:"cityCard"})}]),x(n,ie,"East Asia"),x(r,ce,"North America"),x(a,se,"Europe"),x(o,le,"Latin America & Caribbean"),d3.selectAll(".data svg").style("overflow","visible"),d3.select("#barChart_groupRow3").append("text").attr("text-anchor","middle").text(i18next.t("yaxText",{ns:"chartHeadings"})).attr("class","yaxLabel").attr("transform",function(t){return"translate(-36 -200)rotate(-90)"}),d3.selectAll(".x.axis").selectAll("text").attr("text-anchor","end").attr("transform",function(t){return"translate(-14 10)rotate(-90)"}),_("East Asia"),_("North America"),_("Europe"),_("Southeast Asia"),_("Latin America & Caribbean"),_("South Asia"),w("h1"),w("h2"),w("h3"),w("h4"),w("h5"),w("h6"),w("h7"),w("h8"),w("h9")})}),$(document).on("change",function(t){d3.selectAll(".data").selectAll("rect").classed("isNan",!1),"none"===(d=t.target.value)?(d3.selectAll(".bar-group rect").style("fill","#4a6072"),m()):function(a){u[d]?a():d3.json("".concat(l,"/data/cityApp_attributes_consolidated_").concat(d,".json"),function(t,e){if(u[d]=e,de[d].whichLim)if("d3extent"===de[d].whichLim)u[d].lims=d3.extent(u[d],function(t){return t.value});else if("d3mean"===de[d].whichLim){var n=d3.mean(u[d],function(t){return t.value});u[d].lims=[n-he(n,.9545),n+he(n,.9545)]}if(u[d].lims&&de[d].modx){var r=de[d].modx;u[d].lims=u[d].lims.map(function(t){return Math.floor(t/r)*r})}a()})}(function(){if(function(){if(u[d].lims){var t,e=u[d].lims[0],n=u[d].lims[1],r=d3.scaleQuantile().domain([e,n]).range(de[d].colourRange);t=de[d].cbValues?de[d].cbValues:r.quantiles(),u[d].mappingFn=r,u[d].levels=t}}(),d3.selectAll(".bar-group").each(function(t){if(-1===t.city.indexOf("_gap")){var e,n=t.city;if("region"===d){var r=u[d].filter(function(t){return t.city===n})[0].value;e=i18next.t(r,{ns:"regionColours"})}else{var a=u[d].filter(function(t){return t.city===n})[0].value;e=null===a?(d3.select(this).select("rect").classed("isNan",!0),"none"):u[d].mappingFn(a)}d3.select(this).select("rect").style("fill",e)}}),m(),s){if(s[9]&&(s=s.slice(0,9),"protocol"===d||"year"===d))return void g(s);if("protocol"!==d&&"year"!==d){var t=d3.selectAll(".enlarged").text();A(d,t),g(s)}}})})}var ie={aspectRatio:6.8,margin:{top:0,left:0,right:0,bottom:75},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:3,tickSizeOuter:1},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._selfFormatter.format(e)}},ce={aspectRatio:7.8,margin:{top:0,left:0,right:0,bottom:50},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:3,tickSizeOuter:0},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return console.log(e),e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._selfFormatter.format(e)}},se={aspectRatio:7.8,margin:{top:10,left:0,right:0,bottom:40},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,region:i18next.t(t.region,{ns:"regions"}),value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getRegion:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e[0].region},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:3,tickSizeOuter:0},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._selfFormatter.format(e)}},le={aspectRatio:7,margin:{top:10,left:0,right:0,bottom:60},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,region:i18next.t(t.region,{ns:"regions"}),value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.x.getId.apply(this,e)},getRegion:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e[0].region},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:3,tickSizeOuter:0},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._selfFormatter.format(e)}},ue={margin:{top:0,right:0,bottom:0,left:0},projOptions:{options:[{name:"Natural Earth",projection:d3.geoNaturalEarth()}],transScale:[1.655,1.67],rotateOrig:[0,0],centreOrig:[40,0]},defaultRadius:3,scaleFactor:135,delta:[-22,0],width:750,height:290},de={none:{colourRange:[]},region:{colourRange:[],units:[]},protocol:{whichLim:"d3extent",colourRange:["#9DD3DF","#8856a7","#E35B5D","#EB9F9F","#F18052","#F4DD51"],cbValues:[1,2,3,4,5,6],xpos:[22,86,190,273,355,417],units:[]},year:{whichLim:"d3extent",modx:5,colourRange:["#a63603","#e6550d","#997E68","#fd8d3c","#fecc5c"],xpos:[13,98,182,267,353],units:[]},population:{whichLim:"d3extent",colourRange:["#DED8B6","#fbb4b9","#f768a1","#c51b8a","#7a0177"],xpos:[18,97,182,271,356],units:[],formatLevel:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return d3.format(".2s")(e)}},GDP_PPP_percap:{whichLim:"d3mean",modx:1e3,colourRange:["#b8aca2","#E394A7","#9e9ac8","#756bb1","#54278f"],xpos:[17,105,190,275,360],units:["[$BN/capita]"],formatLevel:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return d3.format(".2s")(e)}},area:{whichLim:"d3mean",modx:100,colourRange:["#ffffcc","#c7e9b4","#41b6c4","#2c7fb8","#253494"],xpos:[32,104,189,275,361],units:["[km2]"]},pop_density:{whichLim:"d3mean",modx:100,colourRange:["#ffffcc","#F9C869","#E1F5C4","#ADD6BC","#486d6c"],xpos:[20,100,183,268,346],units:["[per km2]"]},diesel:{whichLim:"d3extent",colourRange:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],xpos:[17,101,187,271,356],units:["[USD/litre]"],formatLevel:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return d3.format(".2f")(e)}},gas:{whichLim:"d3extent",colourRange:["#F1F2C4","#fecc5c","#fd8d3c","#f03b20","#bd0026"],xpos:[16,102,185,271,357],units:["[USD/litre]"],formatLevel:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return d3.format(".2f")(e)}},HDD:{whichLim:"d3extent",modx:1e3,colourRange:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],xpos:[32,97,182,268,352],units:["[deg C x days]"],unitdef:"Heating degree days, used to estimate the energy needed to heat a building above the base temperature (15.5C here)."},CDD:{whichLim:"d3extent",modx:1e3,colourRange:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],xpos:[32,104,189,268,352],units:["[deg C x days]"],unitdef:"Cooling degree days, used to estimate the energy needed to cool a building below the base temperature (23C here)."},low_bua_pc_2014:{whichLim:"d3extent",colourRange:["#ECDAA8","#B6AC7B","#8C9C82","#9AA0AC","#70725A"],xpos:[16,101,185,270,355],units:["[% of tot BUA]"],unitdef:"An urbran expansion attribute that quantifies the fraction of low built-up area (BUA) out of the total city area in 2014.",formatLevel:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return d3.format(".2f")(e)}},high_bua_pc_2014:{whichLim:"d3extent",colourRange:["#ECDAA8","#B6AC7B","#8C9C82","#9AA0AC","#70725A"],xpos:[16,101,185,270,355],units:["[% of tot BUA]"],unitdef:"An urbran expansion attribute that quantifies the fraction of high built-up area (BUA) out of the total city area in 2014.",formatLevel:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return d3.format(".2f")(e)}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._selfFormatter.format(e)}},fe={groupEastAsia:{xpos:[-31,-20,-9],ypos:[-105,-95,-91],arrowlength:33,arrowscale:[.6,.8],gid:"EA",textscale:[1,1],textposx:[40,60,65],textposy:[-5,-2,10]},groupNAmer:{xpos:[-29,-12,6,22],ypos:[-150,-144,-137,-136],arrowlength:33,arrowscale:[.6,.8],gid:"NAmer",textscale:[.9,.9],textposx:[28,112,33,56],textposy:[-5,19,-11,-5]},groupRow3_Europe:{xpos:[-29],ypos:[-172],arrowlength:30,arrowscale:[.6,.8],gid:"EU",textscale:[.9,.9],textposx:[55],textposy:[-5]},groupRow3_SEasia:{xpos:[770],ypos:[-178],arrowlength:30,arrowscale:[.6,.8],gid:"SEA",textscale:[.9,.9],textposx:[75],textposy:[10]},groupRow4_LA:{xpos:[-28],ypos:[-220],arrowlength:30,arrowscale:[.6,.8],gid:"LA",textscale:[.9,.9],textposx:[75],textposy:[14]},groupRow4_SA:{xpos:[436],ypos:[-220],arrowlength:30,arrowscale:[.6,.8],gid:"SA",textscale:[.9,.9],textposx:[72],textposy:[14]}},pe={Inch:11,Kaoh:11,Yila:11,Clev:11.1,"L V":11.1,Sava:11.1,"F C":11,Rott:11,Quez:11,"Leó":11,Gand:11},ge={_selfFormatter:i18n.getNumberFormatter(2),formatNum:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this._selfFormatter.format(e)}},he=function(){return(arguments.length<=0?void 0:arguments[0])*(arguments.length<=1?void 0:arguments[1])};"undefined"!=typeof Drupal?Drupal.behaviors.dv={attach:function(t,e){oe(Drupal.settings.dv&&Drupal.settings.dv.urlRoot?Drupal.settings.dv.urlRoot:"")}}:oe(".")}();