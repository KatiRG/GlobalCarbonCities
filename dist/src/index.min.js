!function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}function a(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+s).toString(36))}function i(t){return"object"==typeof t?null!==t:"function"==typeof t}function o(t){if(!i(t))throw TypeError(t+" is not an object!");return t}function r(t){try{return!!t()}catch(t){return!0}}function n(t){return d?f.createElement(t):{}}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}var h=t(function(t){var e=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=e)}),y=(h.version,t(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)})),c=t(function(t){var e="__core-js_shared__",r=y[e]||(y[e]={});(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:h.version,mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),e=0,s=Math.random(),u=t(function(t){var e=c("wks"),r=y.Symbol,n="function"==typeof r;(t.exports=function(t){return e[t]||(e[t]=n&&r[t]||(n?r:a)("Symbol."+t))}).store=e}),l=!r(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),f=y.document,d=i(f)&&i(f.createElement),p=!l&&!r(function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}),g=Object.defineProperty,x={f:l?Object.defineProperty:function(t,e,r){if(o(t),e=function(t,e){if(!i(t))return t;var r,n;if(e&&"function"==typeof(r=t.toString)&&!i(n=r.call(t)))return n;if("function"==typeof(r=t.valueOf)&&!i(n=r.call(t)))return n;if(!e&&"function"==typeof(r=t.toString)&&!i(n=r.call(t)))return n;throw TypeError("Can't convert object to primitive value")}(e,!0),o(r),p)try{return g(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},b=l?function(t,e,r){return x.f(t,e,v(1,r))}:function(t,e,r){return t[e]=r,t},m=u("unscopables"),A=Array.prototype;null==A[m]&&b(A,m,{});function w(t){A[m][t]=!0}function _(t,e){return{value:e,done:!!t}}function C(t){return P.call(t).slice(8,-1)}function O(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}function L(t){return R(O(t))}function S(t,e){return j.call(t,e)}function k(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}function T(n,a,t){if(k(n),void 0===a)return n;switch(t){case 1:return function(t){return n.call(a,t)};case 2:return function(t,e){return n.call(a,t,e)};case 3:return function(t,e,r){return n.call(a,t,e,r)}}return function(){return n.apply(a,arguments)}}var F={},P={}.toString,R=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==C(t)?t.split(""):Object(t)},j={}.hasOwnProperty,D=c("native-function-to-string",Function.toString),E=t(function(t){var i=a("src"),e="toString",o=(""+D).split(e);h.inspectSource=function(t){return D.call(t)},(t.exports=function(t,e,r,n){var a="function"==typeof r;a&&(S(r,"name")||b(r,"name",e)),t[e]!==r&&(a&&(S(r,i)||b(r,i,t[e]?""+t[e]:o.join(String(e)))),t===y?t[e]=r:n?t[e]?t[e]=r:b(t,e,r):(delete t[e],b(t,e,r)))})(Function.prototype,e,function(){return"function"==typeof this&&this[i]||D.call(this)})}),N="prototype",I=function(t,e,r){var n,a,i,o,c=t&I.F,s=t&I.G,u=t&I.S,l=t&I.P,f=t&I.B,d=s?y:u?y[e]||(y[e]={}):(y[e]||{})[N],p=s?h:h[e]||(h[e]={}),g=p[N]||(p[N]={});for(n in s&&(r=e),r)i=((a=!c&&d&&void 0!==d[n])?d:r)[n],o=f&&a?T(i,y):l&&"function"==typeof i?T(Function.call,i):i,d&&E(d,n,i,t&I.U),p[n]!=i&&b(p,n,o),l&&g[n]!=i&&(g[n]=i)};y.core=h,I.F=1,I.G=2,I.S=4,I.P=8,I.B=16,I.W=32,I.U=64,I.R=128;function B(t){return isNaN(t=+t)?0:(0<t?q:W)(t)}function M(t){return 0<t?K(B(t),9007199254740991):0}function z(c){return function(t,e,r){var n,a=L(t),i=M(a.length),o=function(t,e){return(t=B(t))<0?Y(t+e,0):X(t,e)}(r,i);if(c&&e!=e){for(;o<i;)if((n=a[o++])!=n)return!0}else for(;o<i;o++)if((c||o in a)&&a[o]===e)return c||o||0;return!c&&-1}}function V(t){return Q[t]||(Q[t]=a(t))}function G(){}function U(t,e,r){t&&!S(t=r?t:t.prototype,lt)&&ut(t,lt,{configurable:!0,value:e})}var H=I,W=Math.ceil,q=Math.floor,K=Math.min,Y=Math.max,X=Math.min,Q=c("keys"),J=z(!1),Z=V("IE_PROTO"),tt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),et=Object.keys||function(t){return function(t,e){var r,n=L(t),a=0,i=[];for(r in n)r!=Z&&S(n,r)&&i.push(r);for(;e.length>a;)S(n,r=e[a++])&&(~J(i,r)||i.push(r));return i}(t,tt)},rt=l?Object.defineProperties:function(t,e){o(t);for(var r,n=et(e),a=n.length,i=0;i<a;)x.f(t,r=n[i++],e[r]);return t},nt=y.document,at=nt&&nt.documentElement,it=V("IE_PROTO"),ot="prototype",ct=function(){var t,e=n("iframe"),r=tt.length;for(e.style.display="none",at.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ct=t.F;r--;)delete ct[ot][tt[r]];return ct()},st=Object.create||function(t,e){var r;return null!==t?(G[ot]=o(t),r=new G,G[ot]=null,r[it]=t):r=ct(),void 0===e?r:rt(r,e)},ut=x.f,lt=u("toStringTag"),ft={};b(ft,u("iterator"),function(){return this});function dt(t){return Object(O(t))}function pt(){return this}var gt=V("IE_PROTO"),ht=Object.prototype,yt=Object.getPrototypeOf||function(t){return t=dt(t),S(t,gt)?t[gt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ht:null},xt=u("iterator"),mt=!([].keys&&"next"in[].keys()),vt="values",bt=function(t,e,r,n,a,i,o){!function(t,e,r){t.prototype=st(ft,{next:v(1,r)}),U(t,e+" Iterator")}(r,e,n);function c(t){if(!mt&&t in g)return g[t];switch(t){case"keys":case vt:return function(){return new r(this,t)}}return function(){return new r(this,t)}}var s,u,l,f=e+" Iterator",d=a==vt,p=!1,g=t.prototype,h=g[xt]||g["@@iterator"]||a&&g[a],y=h||c(a),x=a?d?c("entries"):y:void 0,m="Array"==e&&g.entries||h;if(m&&(l=yt(m.call(new t)))!==Object.prototype&&l.next&&(U(l,f,!0),"function"!=typeof l[xt]&&b(l,xt,pt)),d&&h&&h.name!==vt&&(p=!0,y=function(){return h.call(this)}),!mt&&!p&&g[xt]||b(g,xt,y),F[e]=y,F[f]=pt,a)if(s={values:d?y:c(vt),keys:i?y:c("keys"),entries:x},o)for(u in s)u in g||E(g,u,s[u]);else H(H.P+H.F*(mt||p),e,s);return s}(Array,"Array",function(t,e){this._t=L(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,_(1)):_(0,"keys"==e?r:"values"==e?t[r]:[r,t[r]])},"values");F.Arguments=F.Array,w("keys"),w("values"),w("entries");for(var At=u("iterator"),wt=u("toStringTag"),_t=F.Array,Ct={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ot=et(Ct),Lt=0;Lt<Ot.length;Lt++){var St,kt=Ot[Lt],Tt=Ct[kt],Ft=y[kt],Pt=Ft&&Ft.prototype;if(Pt&&(Pt[At]||b(Pt,At,_t),Pt[wt]||b(Pt,wt,kt),F[kt]=_t,Tt))for(St in bt)Pt[St]||E(Pt,St,bt[St],!0)}var Rt=u("toStringTag"),jt="Arguments"==C(function(){return arguments}()),Dt={};Dt[u("toStringTag")]="z",Dt+""!="[object z]"&&E(Object.prototype,"toString",function(){return"[object "+function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Rt))?r:jt?C(e):"Object"==(n=C(e))&&"function"==typeof e.callee?"Arguments":n}(this)+"]"},!0);var Et,Nt,It,Bt;Et="keys",Nt=function(){return function(t){return et(dt(t))}},It=(h.Object||{})[Et]||Object[Et],(Bt={})[Et]=Nt(It),H(H.S+H.F*r(function(){It(1)}),"Object",Bt);function Mt(t,e){return new(function(t){var e;return Vt(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!Vt(e.prototype)||(e=void 0),i(e)&&null===(e=e[Gt])&&(e=void 0)),void 0===e?Array:e}(t))(e)}function zt(f,t){var d=1==f,p=2==f,g=3==f,h=4==f,y=6==f,x=5==f||y,m=t||Mt;return function(t,e,r){for(var n,a,i=dt(t),o=R(i),c=T(e,r,3),s=M(o.length),u=0,l=d?m(t,s):p?m(t,0):void 0;u<s;u++)if((x||u in o)&&(a=c(n=o[u],u,i),f))if(d)l[u]=a;else if(a)switch(f){case 3:return!0;case 5:return n;case 6:return u;case 2:l.push(n)}else if(h)return!1;return y?-1:g||h?h:l}}var Vt=Array.isArray||function(t){return"Array"==C(t)},Gt=u("species"),Ut=zt(5),Ht="find",Wt=!0;Ht in[]&&Array(1)[Ht](function(){Wt=!1}),H(H.P+H.F*Wt,"Array",{find:function(t,e){return Ut(this,t,1<arguments.length?e:void 0)}}),w(Ht);function qt(t,e){return!!t&&r(function(){e?t.call(null,function(){},1):t.call(null)})}var Kt=zt(1);H(H.P+H.F*!qt([].map,!0),"Array",{map:function(t,e){return Kt(this,t,e)}});var Yt=[].sort,Xt=[1,2,3];H(H.P+H.F*(r(function(){Xt.sort(void 0)})||!r(function(){Xt.sort(null)})||!qt(Yt)),"Array",{sort:function(t){return void 0===t?Yt.call(dt(this)):Yt.call(dt(this),k(t))}});var Qt=x.f,$t=Function.prototype,Jt=/^\s*function ([^ (]*)/;"name"in $t||l&&Qt($t,"name",{configurable:!0,get:function(){try{return(""+this).match(Jt)[1]}catch(t){return""}}});var Zt=zt(0),te=qt([].forEach,!0);H(H.P+H.F*!te,"Array",{forEach:function(t,e){return Zt(this,t,e)}});var ee=zt(2);H(H.P+H.F*!qt([].filter,!0),"Array",{filter:function(t,e){return ee(this,t,e)}});var re=z(!1),ne=[].indexOf,ae=!!ne&&1/[1].indexOf(1,-0)<0;H(H.P+H.F*(ae||!qt(ne)),"Array",{indexOf:function(t,e){return ae?ne.apply(this,arguments)||0:re(this,t,e)}});var ie,oe,ce,se={aspectRatio:8.2,margin:{top:33,right:0,bottom:20,left:0},width:1300,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:5,tickSizeOuter:1},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._selfFormatter.format(e)}},ue={aspectRatio:8.2,margin:{top:0,left:0,right:0,bottom:30},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:5,tickSizeOuter:0},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return console.log(e),e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._selfFormatter.format(e)}},le={aspectRatio:8.2,margin:{top:10,left:0,right:0,bottom:20},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,region:i18next.t(t.region,{ns:"regions"}),value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getRegion:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e[0].region},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:5,tickSizeOuter:0},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._selfFormatter.format(e)}},fe={aspectRatio:8.2,margin:{top:10,left:0,right:0,bottom:20},width:1200,groupPadding:0,pOuter:.9,pInner:.15,filterData:function(t){return[{category:i18next.t(t[0].region,{ns:"regions"}),values:t.map(function(t,e){return{city:t.city,region:i18next.t(t.region,{ns:"regions"}),value:t.s1PerCap,storeOrig:t.storeOrig,idx:e}})}]},x:{getId:function(t){return t.city},getValue:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.x.getId.apply(this,e)},getRegion:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e[0].region},getTickText:function(t){return i18next.t(t,{ns:"railBar"})}},y:{label:i18next.t("y_label",{ns:"railBar"}),getValue:function(t){return t.value},getText:function(t){return t.value},getDomain:function(t){return[0,10]},ticks:5,tickSizeOuter:0},z:{label:i18next.t("z_label",{ns:"railTable"}),getId:function(t){return t.category},getKeys:function(t){var e=Object.keys(t[0]);return e.splice(e.indexOf("category"),1),e},formatData:function(t){return t[0].values},getClass:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.z.getId.apply(this,e)},getDataPoints:function(t){return t.values},getText:function(t){return i18next.t(t.key,{ns:"rail"})}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._selfFormatter.format(e)}},de={none:{colourRange:[]},region:{colourRange:[],units:[]},protocol:{whichLim:"d3extent",colourRange:["#9DD3DF","#8856a7","#E35B5D","#EB9F9F","#F18052","#F4DD51"],cbValues:[1,2,3,4,5,6],xpos:[22,86,190,273,355,417],units:[]},year:{whichLim:"d3extent",modx:5,colourRange:["#a63603","#e6550d","#997E68","#fd8d3c","#fecc5c"],xpos:[13,98,182,267,353],units:[]},population:{whichLim:"d3extent",colourRange:["#DED8B6","#fbb4b9","#f768a1","#c51b8a","#7a0177"],xpos:[18,97,182,271,356],units:[],formatLevel:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return d3.format(".2s")(e)}},GDP_PPP_percap:{whichLim:"d3mean",modx:1e3,colourRange:["#b8aca2","#E394A7","#9e9ac8","#756bb1","#54278f"],xpos:[17,105,190,275,360],units:["[$BN/capita]"],formatLevel:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return d3.format(".2s")(e)}},area:{whichLim:"d3mean",modx:100,colourRange:["#ffffcc","#c7e9b4","#41b6c4","#2c7fb8","#253494"],xpos:[32,104,189,275,361],units:["[km2]"]},pop_density:{whichLim:"d3mean",modx:100,colourRange:["#ffffcc","#F9C869","#E1F5C4","#ADD6BC","#486d6c"],xpos:[20,100,183,268,346],units:["[per km2]"]},diesel:{whichLim:"d3extent",colourRange:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],xpos:[17,101,187,271,356],units:["[USD/litre]"],formatLevel:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return d3.format(".2f")(e)}},gas:{whichLim:"d3extent",colourRange:["#F1F2C4","#fecc5c","#fd8d3c","#f03b20","#bd0026"],xpos:[16,102,185,271,357],units:["[USD/litre]"],formatLevel:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return d3.format(".2f")(e)}},HDD:{whichLim:"d3extent",modx:1e3,colourRange:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],xpos:[32,97,182,268,352],units:["[deg C x days]"],unitdef:"Heating degree days, used to estimate the energy needed to heat a building above the base temperature (15.5C here)."},CDD:{whichLim:"d3extent",modx:1e3,colourRange:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],xpos:[32,104,189,268,352],units:["[deg C x days]"],unitdef:"Cooling degree days, used to estimate the energy needed to cool a building below the base temperature (23C here)."},low_bua_pc_2014:{whichLim:"d3extent",colourRange:["#ECDAA8","#B6AC7B","#8C9C82","#9AA0AC","#70725A"],xpos:[16,101,185,270,355],units:["[% of tot BUA]"],unitdef:"An urbran expansion attribute that quantifies the fraction of low built-up area (BUA) out of the total city area in 2014.",formatLevel:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return d3.format(".2f")(e)}},high_bua_pc_2014:{whichLim:"d3extent",colourRange:["#ECDAA8","#B6AC7B","#8C9C82","#9AA0AC","#70725A"],xpos:[16,101,185,270,355],units:["[% of tot BUA]"],unitdef:"An urbran expansion attribute that quantifies the fraction of high built-up area (BUA) out of the total city area in 2014.",formatLevel:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return d3.format(".2f")(e)}},_selfFormatter:i18n.getNumberFormatter(0),formatNum:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._selfFormatter.format(e)}},pe=250,ge={width:210,height:310,pos:[20,-20]},he={groupEastAsia:{xpos:[-15,-2,9],ypos:[-100,-95,-91],arrowlength:33,arrowscale:[.6,.8],gid:"EA",textscale:[1,1],textposx:[40,60,65],textposy:[-2,2,10]},groupNAmer:{xpos:[-20,-3,13,30],ypos:[-145,-139,-137,-135],arrowlength:33,arrowscale:[.6,.8],gid:"NAmer",textscale:[.9,.9],textposx:[28,112,33,51],textposy:[0,14,-4,-5]},groupRow3_Europe:{xpos:[-21],ypos:[-172],arrowlength:30,arrowscale:[.6,.8],gid:"EU",textscale:[.9,.9],textposx:[55],textposy:[-5]},groupRow3_SEasia:{xpos:[761],ypos:[-178],arrowlength:30,arrowscale:[.6,.8],gid:"SEA",textscale:[.9,.9],textposx:[75],textposy:[10]},groupRow4_LA:{xpos:[-22],ypos:[-220],arrowlength:30,arrowscale:[.6,.8],gid:"LA",textscale:[.9,.9],textposx:[75],textposy:[14]},groupRow4_SA:{xpos:[413],ypos:[-220],arrowlength:30,arrowscale:[.6,.8],gid:"SA",textscale:[.9,.9],textposx:[72],textposy:[14]}},ye={Inch:11,Kaoh:11,Yila:11,Clev:11.1,"L V":11.1,Sava:11.1,"F C":11,Rott:11,Quez:11,"LeÃ³":11,Gand:11},xe={_selfFormatter:i18n.getNumberFormatter(2),formatNum:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this._selfFormatter.format(e)}},me=function(t,e){return(arguments.length<=0?void 0:t)*(arguments.length<=1?void 0:e)},ve=[],be="init",Ae=850-0-0,we=290-0-0,_e=520-0-5,Ce=35-7-0,Oe=d3.select(".data.EAdata").append("svg").attr("id","barChart_groupEastAsia"),Le=d3.select(".data.NAdata").append("svg").attr("id","barChart_groupNAmer"),Se=d3.select(".data.EUdata").append("svg").attr("id","barChart_groupRow3"),ke=d3.select(".data.dataRow4").append("svg").attr("id","barChart_groupRow4"),Te=d3.select("#barChartLegend").select("svg").attr("width",_e).attr("height",Ce).attr("transform","translate(120,0)").style("vertical-align","middle");var Fe=d3.select("#mycityCardDiv"),Pe=d3.select();function Re(t){var e=t;Pe.remove();var r=Fe.selectAll(".cardrow",function(t){return t.id}).data(e);r.enter().append("div").attr("class",function(t,e){return 0===e?"cardrow titlerow row".concat(e):"cardrow subrow row".concat(e)}).html(function(t){return t.text}),r.attr("class",function(t,e){return 0===e?"cardrow titlerow row".concat(e):"cardrow updated row".concat(e)}).html(function(t){return t.text}),Pe=r.exit().attr("class","oldrow removed").html(function(t){})}function je(r){var n=[];return ie.filter(function(t){if(t.region===r){var e={};e.region=t.region,e.city=t.city,e.s1PerCap=t.s1PerCap,e.storeOrig=t.storeOrig?t.storeOrig:null,n.push(e)}}),n.sort(function(t,e){return d3.descending(t.s1PerCap,e.s1PerCap)}),n}function De(t,e){t.sort(function(t,e){return d3.descending(t.s1PerCap,e.s1PerCap)});for(var r=0;r<e;r++){var n={};n.region=t[0].region,n.city="".concat(t[0].region,"_gap").concat(r),n.s1PerCap=null,n.storeOrig=null,t.push(n)}return t}function Ee(t,e,r){var n=[];if(n=je(r),"Europe"===r)n=De(n,3).concat(je("Southeast Asia"));else if("Latin America & Caribbean"===r){var a=De(n,2),i=De(je("South Asia"),2),o=De(je("Africa"),2),c=De(je("N Africa & W Asia"),1),s=je("Oceania");n=a.concat(i).concat(o).concat(c).concat(s)}else"North America"===r&&(n=De(n,1));barChart(t,e,n),d3.select("#barChart_groupEastAsia").select(".margin-offset").attr("transform","translate(0, -70)"),d3.select("#barChart_groupNAmer").select(".margin-offset").attr("transform","translate(0, -115)"),d3.select("#barChart_groupRow3").select(".margin-offset").attr("transform","translate(0, -150)"),d3.select("#barChart_groupRow4").select(".margin-offset").attr("transform","translate(0, -190)");var u=d3.select("body").append("div").attr("class","tooltip-bar").style("opacity",0);d3.selectAll(".x.axis").selectAll("text").on("touchmove mousemove",function(t,e){if(d3.selectAll(".enlarged").classed("enlarged",!1),-1===d3.select(this).text().indexOf("_gap")){var r=i18next.t(d3.select(this).text(),{ns:"cities"});d3.select(this).classed("enlarged",!0),d3.selectAll(".x.axis g :not(#text_".concat(r,")")).classed("fadeText",!0),Be(d3.select(this).text())}}).on("mouseout",function(t){d3.selectAll(".x.axis g text").classed("fadeText",!1),ze();var e=d3.select(".enlarged").text();d3.select(".bar-group.".concat(i18next.t(e,{ns:"cities"}))).select("rect").classed("active",!0),d3.select("#city".concat(i18next.t(e,{ns:"cities"}))).classed("cityactive",!0)}),d3.selectAll(".bar-group").on("touchmove mousemove",function(t,e){d3.selectAll(".enlarged").classed("enlarged",!1);var r=i18next.t(t.city,{ns:"cities"});d3.select("#text_".concat(r)).classed("enlarged",!0);var n=e+1;Be(t.city);var a=i18next.t(t.city,{ns:"displayName"}),i=t.storeOrig?t.storeOrig:t.value;u.style("opacity",1),u.html("#".concat(n,". ").concat(a," <br>").concat(xe.formatNum(i)," ").concat(i18next.t("emissions per cap",{ns:"units"}))).style("left",d3.event.pageX+30+"px").style("top",d3.event.pageY+-50+"px")}).on("mouseout",function(t){u.style("opacity",0),ze();var e=d3.select(".enlarged").text();d3.select(".bar-group.".concat(i18next.t(e,{ns:"cities"}))).select("rect").classed("active",!0),d3.select("#city".concat(i18next.t(e,{ns:"cities"}))).classed("cityactive",!0)})}function Ne(){function t(t,e){return de[be].colourRange[e]}function e(t,e){return"protocol"===be?i18next.t("".concat(be).concat(e+1),{ns:"legend"}):"region"===be?"":(r=0===e?ve[be].lims[e]:ve[be].levels[e-1],r=de[be].formatLevel?de[be].formatLevel(r):r,"".concat(r,"+"));var r}var r=de[be].xpos,n=d3.select("body").append("div").attr("class","tooltip-legend").style("opacity",0),a=Te.attr("class","legendCB").selectAll(".legend").data(de[be].colourRange),i=a.enter().append("g").attr("class","legend").attr("id",function(t,e){return"cb".concat(e)});i.append("rect").attr("width",15).attr("height",15).attr("y",5).attr("x",function(t,e){return 51+85*e}).attr("fill",t),i.selectAll(".legend rect").on("touchmove mousemove",function(t,e){if("protocol"===be){var r=i18next.t("".concat(be).concat(e+1),{ns:"legend"});n.style("opacity",1),n.html("<b>".concat(r,"</b>: ").concat(i18next.t("".concat(r),{ns:"protocolFullName"}))).style("left",d3.event.pageX-100+"px").style("top",d3.event.pageY-70+"px")}}).on("mouseout",function(t){n.style("opacity",0)}),i.append("text").attr("class","legendText").text(e).attr("y",18).attr("x",function(t,e){return r[e]}),a.select("rect").attr("fill",t),a.select("text").text(e).attr("x",function(t,e){return r[e]}),a.exit().remove();var o=de[be].units,c=d3.select(".units");c.text(o),"HDD"===be||"HDD"===be||"low_bua_pc_2014"===be||"high_bua_pc_2014"===be?d3.select(".units").classed("unitsactive",!0):d3.select(".units").classed("unitsactive",!1);var s=d3.select("body").append("div").attr("class","tooltip-units").style("opacity",0);c.on("touchmove mousemove",function(){de[be].unitdef&&(s.style("opacity",1),s.html("<b>".concat(i18next.t(be,{ns:"attributes"}),"</b>: ").concat(de[be].unitdef)).style("left",d3.event.pageX-100+"px").style("top",d3.event.pageY-70+"px"))}).on("mouseout",function(t){s.style("opacity",0)})}d3.select("#mapResetButton").on("click",function(){d3.selectAll(".enlarged").classed("enlarged",!1),d3.selectAll("rect.active").classed("active",!1),d3.selectAll(".cityactive").classed("cityactive",!1)});function Ie(t){d3.select("#".concat(t)).text(i18next.t(t,{ns:"chartHeadings"}))}function Be(e){var t=i18next.t(e,{ns:"cities"});ze();var r=ie.filter(function(t){return t.city===e})[0].country,n=ie.filter(function(t){return t.city===e})[0].scope1,a=ie.filter(function(t){return t.city===e})[0].year,i=ie.filter(function(t){return t.city===e})[0].dataset,o=ie.filter(function(t){return t.city===e})[0].protocol,c=i18next.t(e,{ns:"displayName"});oe=[{id:1,text:"".concat(c,", ").concat(r)},{id:2,text:i18next.t("scope1Row",{ns:"cityCard"})},{id:3,text:"".concat(n," ").concat(i18next.t("scope1",{ns:"units"})," ").concat(i18next.t("defn",{ns:"units"}))},{id:4,text:i18next.t("yearRow",{ns:"cityCard"})},{id:5,text:a},{id:6,text:i18next.t("datasetRow",{ns:"cityCard"})},{id:7,text:i18next.t(i,{ns:"datasets"})},{id:8,text:i18next.t("protocolRow",{ns:"cityCard"})},{id:9,text:i18next.t(o,{ns:"protocol"})}],ve[be]&&"protocol"!==be&"year"!==be&&Me(be,e),Re(oe),d3.select(".bar-group.".concat(t)).select("rect").classed("active",!0),d3.selectAll(".bar-group:not(.".concat(t,")")).select("rect").classed("fade",!0),d3.selectAll("#city"+t).classed("cityactive",!0),d3.selectAll(".worldcity:not(#city"+t+")").classed("cityfade",!0),d3.selectAll(".worldcountry:not(#map".concat(i18next.t(r,{ns:"countries"}),")")).classed("countryfade",!0)}function Me(t,e){var r,n=ve[t].filter(function(t){return t.city===e})[0].value,a="N/A"===(r="string"==typeof n||n instanceof String?n:null===n?"N/A":d3.format(",")(n)?d3.format(",")(n):n)?"":i18next.t(t,{ns:"units"});oe.push({id:10,text:i18next.t(t,{ns:"attributes"})},{id:11,text:"".concat(r," ").concat(a)})}function ze(){d3.selectAll(".bar-group").selectAll("rect").classed("active",!1).classed("fade",!1),d3.selectAll(".cityactive").classed("cityactive",!1),d3.selectAll(".cityfade").classed("cityfade",!1),d3.selectAll(".countryfade").classed("countryfade",!1)}function Ve(e){var a,i=[],o=i18next.t(e,{ns:"barchartGroups"});a="Europe"===e?"".concat(o,"_").concat(e):"Southeast Asia"===e?"".concat(o,"_SEasia"):"Latin America & Caribbean"===e?"".concat(o,"_LA"):"South Asia"===e?"".concat(o,"_SA"):"N Africa & W Asia"===e?"".concat(o,"_NAWA"):o;var c=he[a].xpos,s=he[a].ypos,u=he[a].arrowlength,l=he[a].gid,f=0,d=0,p=0,g=0,h=200-g-d,y=200-f-p,x=[],r=0;ie.filter(function(t){t.region===e&&t.storeOrig&&(x.push(t.storeOrig),i.push({id:r,name:"arrow"+r,path:"M 2,2 L2,11 L10,6 L2,2"}),r++)});for(var t=function(e){var t=d3.select("#barChart_".concat(o)).append("g").attr("class","barMarker").attr("id","g_".concat(l).concat(e)).attr("height",y+f+p).attr("transform","translate("+c[e]+","+s[e]+")").append("svg").attr("width",h+g+d),r=t.append("svg:defs"),n=t.append("svg:g").attr("id","markers".concat(e));r.selectAll("marker").data(i).enter().append("svg:marker").attr("id",function(t){return"marker_arrow".concat(e)}).attr("markerHeight",13).attr("markerWidth",13).attr("markerUnits","strokeWidth").attr("orient","auto").attr("refX",9.5).attr("refY",6).append("svg:path").attr("d",function(t){return t.path}),n.selectAll("path").data(i).enter().append("svg:path").attr("d",function(t,e){return"M 100, 0 V ".concat(u,", 0 ")}).attr("stroke-width",1.2).attr("marker-start",function(t){return"url(#marker_stub".concat(e,")")}).attr("marker-end",function(t){return"url(#marker_arrow".concat(e,")")}).attr("transform",function(t){return"scale(".concat(he[a].arrowscale[0]," ").concat(he[a].arrowscale[1],")")}).append("svg:path").attr("d",function(t){return t.path}),d3.select("#g_".concat(l).concat(e)).append("text").text(x[e]).attr("transform",function(){return"scale(".concat(he[a].textscale[0]," ").concat(he[a].textscale[1],")\n            translate(").concat(he[a].textposx[e]," ").concat(he[a].textposy[e],")")})},n=0;n<x.length;n++)t(n)}i18n.load(["src/i18n"],function(){d3.queue().defer(d3.json,"data/cityApp_attributes_consolidated_fixedSet.json").await(function(t,e){(ie=e).map(function(e){e.scope1=d3.format(".3n")(e.scope1/1e6),Object.keys(ye).find(function(t){return t===e.city})&&(e.storeOrig=e.s1PerCap,e.s1PerCap=ye[e.city])}),d3.select("#download").html(i18next.t("downloadText",{ns:"pageText"})),d3.select("#titletag").html(i18next.t("titletag",{ns:"pageText"})),d3.select("#pageTitle").html(i18next.t("title",{ns:"pageText"})),function(){var t=[{name:"Natural Earth",projection:d3.geoNaturalEarth()}];t.forEach(function(t){t.projection.rotate([0,0]).center([40,0])});var e=t[0].projection.scale(151).translate([Ae/1.655,we/1.67]);ce=d3.geoPath().projection(e).pointRadius([3]);var r=d3.geoGraticule(),n=d3.select("#map").append("svg").attr("width",Ae).attr("height",we).attr("transform","translate(-25,0)").append("g");n.append("path").datum({type:"Sphere"}).attr("class","sphere").attr("d",ce).attr("fill","#F4F7F7").attr("stroke","grey"),n.append("path").datum(r).attr("class","graticule").attr("d",ce),d3.json("geojson/world_countries.json",function(t,r){if(t)throw t;d3.json("geojson/our_cities.geojson",function(t,e){if(t)throw t;n.attr("class","mapg").selectAll("path").data(r.features).enter().append("path").attr("d",ce).attr("id",function(t){var e=i18next.t(t.properties.name,{ns:"countries"});return"map".concat(e)}).attr("class","worldcountry").style("stroke-width",1),e=n.selectAll("path").data(e.features).enter().append("path").attr("d",ce).attr("id",function(t){var e=i18next.t(t.id,{ns:"reverse"});return"city"+i18next.t(e,{ns:"cities"})}).attr("class",function(t){var e=i18next.t(t.id,{ns:"reverse"}),r=ie.filter(function(t){return t.city===e})[0];return r?"worldcity ".concat(i18next.t(r.region,{ns:"regions"})):"horsService"}).attr("r",10).on("mouseover",function(t){d3.selectAll(".enlarged").classed("enlarged",!1);var e=i18next.t(t.id,{ns:"reverse"});d3.select("#text_".concat(i18next.t(e,{ns:"cities"}))).classed("enlarged",!0),Be(e)}).on("mouseout",function(t){ze();var e=d3.select(".enlarged").text();d3.select(".bar-group.".concat(i18next.t(e,{ns:"cities"}))).select("rect").classed("active",!0),d3.select("#city".concat(i18next.t(e,{ns:"cities"}))).classed("cityactive",!0)})})})}(),d3.select("#mycityCardDiv").append("svg").attr("width",273).attr("height",we).attr("width",pe).attr("height",we).append("g").attr("id","cityCardg").append("rect").attr("width",ge.width).attr("height",ge.height).attr("x",ge.pos[0]).attr("y",ge.pos[1]),Re([{id:1,text:i18next.t("initTitle",{ns:"cityCard"})},{id:2,text:i18next.t("initRow1",{ns:"cityCard"})},{id:3,text:i18next.t("initRow2",{ns:"cityCard"})},{id:4,text:i18next.t("initRow3",{ns:"cityCard"})},{id:5,text:i18next.t("initRow4",{ns:"cityCard"})}]),Ee(Oe,se,"East Asia"),Ee(Le,ue,"North America"),Ee(Se,le,"Europe"),Ee(ke,fe,"Latin America & Caribbean"),d3.selectAll(".data svg").style("overflow","visible"),d3.select("#barChart_groupRow3").append("text").attr("text-anchor","middle").text(i18next.t("yaxText",{ns:"chartHeadings"})).attr("class","yaxLabel").attr("transform",function(t){return"translate(-35 -135)rotate(-90)"}),Ve("East Asia"),Ve("North America"),Ve("Europe"),Ve("Southeast Asia"),Ve("Latin America & Caribbean"),Ve("South Asia"),Ie("h1"),Ie("h2"),Ie("h3"),Ie("h4"),Ie("h5"),Ie("h6"),Ie("h7"),Ie("h8"),Ie("h9")})}),$(document).on("change",function(t){d3.selectAll(".data").selectAll("rect").classed("isNan",!1),"none"===(be=t.target.value)?(d3.selectAll(".bar-group rect").style("fill","#4a6072"),Ne()):function(a){ve[be]?a():d3.json("data/cityApp_attributes_consolidated_".concat(be,".json"),function(t,e){if(ve[be]=e,de[be].whichLim)if("d3extent"===de[be].whichLim)ve[be].lims=d3.extent(ve[be],function(t){return t.value});else if("d3mean"===de[be].whichLim){var r=d3.mean(ve[be],function(t){return t.value});ve[be].lims=[r-me(r,.9545),r+me(r,.9545)]}if(ve[be].lims&&de[be].modx){var n=de[be].modx;ve[be].lims=ve[be].lims.map(function(t){return Math.floor(t/n)*n})}a()})}(function(){if(function(){if(ve[be].lims){var t,e=ve[be].lims[0],r=ve[be].lims[1],n=d3.scaleQuantile().domain([e,r]).range(de[be].colourRange);t=de[be].cbValues?de[be].cbValues:n.quantiles(),ve[be].mappingFn=n,ve[be].levels=t}}(),d3.selectAll(".bar-group").each(function(t){if(-1===t.city.indexOf("_gap")){var e,r=t.city;if("region"===be){var n=ve[be].filter(function(t){return t.city===r})[0].value;e=i18next.t(n,{ns:"regionColours"})}else{var a=ve[be].filter(function(t){return t.city===r})[0].value;e=null===a?(d3.select(this).select("rect").classed("isNan",!0),"none"):ve[be].mappingFn(a)}d3.select(this).select("rect").style("fill",e)}}),Ne(),oe){if(oe[9]&&(oe=oe.slice(0,9),"protocol"===be||"year"===be))return void Re(oe);if("protocol"!==be&&"year"!==be){var t=d3.selectAll(".enlarged").text();Me(be,t),Re(oe)}}})})}();